#!/usr/bin/env ruby

require 'karafka'
require 'optparse'

# We set this to indicate, that the process in which we are (whatever it does) was started using
# our bin/karafka cli
ENV['KARAFKA_CLI'] = 'true'

# Command we want to run, like install, server, etc
command_name = ARGV[0]
# Action for action-based commands like topics migrate
action = ARGV[1].to_s.start_with?('-') ? ARGV[1] : false

Karafka::Cli::Base.load

command = ObjectSpace
          .each_object(Class).select { |klass| klass < Karafka::Cli::Base }
          .find { |command| command.names.include?(command_name) }

if command
  # Only actionable commands require command as an argument
  args = action ? [action] : []

  command.new.call(*args)
else
  raise
end
